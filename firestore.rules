rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 4. Biometric Vault (生体データ金庫)
    match /voice_assets/{assetId} {
      allow create: if true;
      allow read, update, delete: if false;
    }
    
    // 2. Results collection (診断結果)
    match /results/{resultId} {
      allow create: if true;
      allow read: if true; 
      allow update: if true; // Webhook handler needs to unlock
      allow delete: if false; // クライアントからは削除不可
    }

    // 3. Subscriptions (サブスクリプション) - NEW
    match /subscriptions/{userHash} {
      allow read: if true;
      allow write: if true; // Webhook handler needs to update status
    }

    // デフォルトはすべて禁止
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
