rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Statistics are publicly visible, but only updated via increment
    match /stats/{doc} {
      allow read: if true;
      allow write: if false; // Only via Admin SDK/Cloud Functions
    }

    // Results collection
    match /results/{resultId} {
      // Anyone can create a result record (initial scan)
      allow create: if true;
      
      // Public can only read their own session or if they have the ID
      // For simplicity in this viral app, we allow read by ID
      allow read: if true;

      // CRITICAL: No one can update a result record once created from the client
      // Premium status, AI reports, and Vault status are updated via Admin SDK/Webhooks
      allow update, delete: if false;
    }
  }
}
